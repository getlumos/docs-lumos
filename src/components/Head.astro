---
/**
 * Custom Head component for LUMOS documentation
 * Extends Starlight's default Head with:
 * - og:image and twitter:image (per-page OG images)
 * - Schema.org JSON-LD structured data
 */

const { head } = Astro.locals.starlightRoute;
const { entry, slug } = Astro.locals.starlightRoute;

// Get page metadata
const title = entry?.data?.title || 'LUMOS - Solana Schema Generation Tool';
const description = entry?.data?.description || 'Generate synchronized Rust + TypeScript code from Solana schemas. Type-safe Borsh serialization.';

// Build OG image URL
const siteUrl = 'https://docs.lumos-lang.org';
const ogImagePath = slug ? `/og/${slug}.png` : '/og/index.png';
const ogImageUrl = `${siteUrl}${ogImagePath}`;
const canonicalUrl = slug ? `${siteUrl}/${slug}/` : `${siteUrl}/`;

// Schema.org structured data
const schemaOrg = {
  '@context': 'https://schema.org',
  '@graph': [
    // Organization
    {
      '@type': 'Organization',
      '@id': 'https://lumos-lang.org/#organization',
      'name': 'LUMOS',
      'url': 'https://lumos-lang.org',
      'logo': {
        '@type': 'ImageObject',
        'url': 'https://docs.lumos-lang.org/favicon.png'
      },
      'sameAs': [
        'https://github.com/getlumos',
        'https://twitter.com/getlumos'
      ]
    },
    // WebSite
    {
      '@type': 'WebSite',
      '@id': 'https://docs.lumos-lang.org/#website',
      'url': 'https://docs.lumos-lang.org',
      'name': 'LUMOS Documentation',
      'description': 'Official documentation for LUMOS - Type-safe schema language for Solana development',
      'publisher': {
        '@id': 'https://lumos-lang.org/#organization'
      }
    },
    // SoftwareApplication
    {
      '@type': 'SoftwareApplication',
      '@id': 'https://lumos-lang.org/#software',
      'name': 'LUMOS',
      'alternateName': ['LUMOS Schema Generator', 'Solana Schema Tool'],
      'description': 'Solana schema generation tool that generates synchronized Rust and TypeScript code from a single source. Type-safe Borsh serialization with Anchor integration.',
      'applicationCategory': 'DeveloperApplication',
      'applicationSubCategory': 'Code Generator',
      'operatingSystem': 'Cross-platform',
      'offers': {
        '@type': 'Offer',
        'price': '0',
        'priceCurrency': 'USD'
      },
      'author': {
        '@id': 'https://lumos-lang.org/#organization'
      },
      'downloadUrl': 'https://crates.io/crates/lumos-cli',
      'softwareVersion': '0.3.0',
      'programmingLanguage': ['Rust', 'TypeScript', 'Python', 'Go', 'Ruby'],
      'keywords': ['Solana Schema Generation', 'Solana Schema Tool', 'Schema Generator', 'Solana Code Generator', 'Rust TypeScript Generator', 'Borsh Serialization', 'Anchor Integration', 'Type-safe Solana', 'Schema Language', 'Solana Development Tools']
    },
    // WebPage (current page)
    {
      '@type': 'WebPage',
      '@id': `${canonicalUrl}#webpage`,
      'url': canonicalUrl,
      'name': `${title} | LUMOS`,
      'description': description,
      'isPartOf': {
        '@id': 'https://docs.lumos-lang.org/#website'
      },
      'about': {
        '@id': 'https://lumos-lang.org/#software'
      },
      'image': ogImageUrl
    }
  ]
};
---

{/* Google Analytics 4 - must be early in head for Search Console verification */}
<script async src="https://www.googletagmanager.com/gtag/js?id=G-1NZRT4TYL6"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-1NZRT4TYL6');
</script>

{/* Render default Starlight head elements */}
{head.map(({ tag: Tag, attrs, content }) => <Tag {...attrs} set:html={content} />)}

{/* OG Image */}
<meta property="og:image" content={ogImageUrl} />
<meta property="og:image:width" content="1200" />
<meta property="og:image:height" content="630" />
<meta property="og:image:type" content="image/png" />

{/* Twitter Card enhancements */}
<meta name="twitter:image" content={ogImageUrl} />
<meta name="twitter:title" content={title} />
<meta name="twitter:description" content={description} />

{/* Schema.org JSON-LD */}
<script type="application/ld+json" set:html={JSON.stringify(schemaOrg)} />
